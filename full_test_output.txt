bun test v1.3.0 (b0a6feca)

::group::test/permissions.test.ts:
(pass) Permission Validation > verifyRepositoryAccess > should return true for admin permission [1.00ms]
(pass) Permission Validation > verifyRepositoryAccess > should return true for write permission
(pass) Permission Validation > verifyRepositoryAccess > should return false for read permission
(pass) Permission Validation > verifyRepositoryAccess > should return false for none permission
(pass) Permission Validation > verifyRepositoryAccess > should bypass permission check for GitHub App bots
(pass) Permission Validation > verifyRepositoryAccess > should call API with correct parameters
(pass) Permission Validation > verifyRepositoryAccess > should throw error on API failure
(pass) Permission Validation > verifyRepositoryAccess > should handle network errors
(pass) Permission Validation > verifyRepositoryAccess > should log actor info [1.00ms]
(pass) Permission Validation > verifyRepositoryAccess > should work with different repository names
(pass) Permission Validation > verifyRepositoryAccess > should recognize various bot naming patterns

::endgroup::

::group::test/graphql-data-fetcher.test.ts:
(pass) GraphQLGitHubDataFetcher > fetchPullRequestData > should fetch and return PR data successfully [1.00ms]
(pass) GraphQLGitHubDataFetcher > fetchPullRequestData > should handle null author [1.00ms]
GraphQL request failed, will retry: Internal Server Error
GraphQL attempt 1 failed. 3 retries left.
(pass) GraphQLGitHubDataFetcher > fetchPullRequestData > should retry on transient errors [1001.00ms]
Non-retryable GraphQL error: Not Found
(pass) GraphQLGitHubDataFetcher > fetchPullRequestData > should not retry on 404 errors
(pass) GraphQLGitHubDataFetcher > fetchIssueData > should fetch and return issue data successfully [1.00ms]
(pass) GraphQLGitHubDataFetcher > fetchIssueData > should handle null author
GraphQL request failed, will retry: Bad Gateway
GraphQL attempt 1 failed. 3 retries left.
GraphQL request failed, will retry: Bad Gateway
GraphQL attempt 2 failed. 2 retries left.
(pass) GraphQLGitHubDataFetcher > fetchIssueData > should retry on transient errors [3002.01ms]
Authentication error: Unauthorized
(pass) GraphQLGitHubDataFetcher > fetchIssueData > should not retry on authentication errors

::endgroup::

::group::test/trigger-validation.test.ts:
(pass) Trigger Validation > escapeRegExp > should escape special regex characters
Issue assigned to trigger user 'junie-bot'
(pass) Trigger Validation > detectJunieTriggerPhrase > assignee trigger > should trigger when issue is assigned to trigger user
Issue assigned to trigger user 'junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > assignee trigger > should handle @ prefix in trigger user
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > assignee trigger > should not trigger when assigned to different user
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > assignee trigger > should not trigger when assignee is missing
Issue labeled with trigger label 'junie'
(pass) Trigger Validation > detectJunieTriggerPhrase > label trigger > should trigger when issue is labeled with trigger label
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > label trigger > should not trigger when labeled with different label
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > label trigger > should not trigger when label is missing
Issue body contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should trigger when phrase is in issue body
Issue title contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should trigger when phrase is in issue title
Issue body contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should trigger when phrase is at start of text
Issue body contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should trigger when phrase is at end of text
Issue body contains exact trigger phrase '@junie-agent'
Issue body contains exact trigger phrase '@junie-agent'
Issue body contains exact trigger phrase '@junie-agent'
Issue body contains exact trigger phrase '@junie-agent'
Issue body contains exact trigger phrase '@junie-agent'
Issue body contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should trigger with punctuation after phrase
No trigger was met for @junie-agent
No trigger was met for @junie-agent
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should not trigger when phrase is part of another word
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should not trigger when phrase is missing
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should handle empty body and title
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in issue > should handle null body
Pull request body contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in PR > should trigger when phrase is in PR body
Pull request title contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in PR > should trigger when phrase is in PR title
Comment contains exact trigger phrase '/(^|\s)@junie-agent([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in comments > should trigger on issue comment
Comment contains exact trigger phrase '/(^|\s)@junie-agent([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in comments > should trigger on PR comment
Pull request review contains exact trigger phrase '/(^|\s)@junie-agent([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in comments > should trigger on PR review
Comment contains exact trigger phrase '/(^|\s)@junie-agent([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in comments > should trigger on PR review comment
No trigger was met for @junie-agent
(pass) Trigger Validation > detectJunieTriggerPhrase > trigger phrase in comments > should not trigger when comment lacks trigger phrase
Comment contains exact trigger phrase '/(^|\s)\/ai([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > custom trigger phrases > should work with custom trigger phrase
Comment contains exact trigger phrase '/(^|\s)\$bot([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > custom trigger phrases > should escape special characters in custom trigger
Pull request review contains exact trigger phrase '/(^|\s)@junie-agent([\s.,!?;:]|$)/i'
(pass) Trigger Validation > detectJunieTriggerPhrase > PR review comment with edited action > should trigger on edited review

::endgroup::

::group::test/new-prompt-formatter.test.ts:
(pass) NewGitHubPromptFormatter > generatePrompt includes repository info [1.00ms]
(pass) NewGitHubPromptFormatter > generatePrompt includes actor info
(pass) NewGitHubPromptFormatter > generatePrompt includes PR info when available
(pass) NewGitHubPromptFormatter > generatePrompt includes commits info [1.00ms]
(pass) NewGitHubPromptFormatter > generatePrompt includes changed files info
(pass) NewGitHubPromptFormatter > generatePrompt includes issue info when not a PR
(pass) NewGitHubPromptFormatter > generatePrompt includes custom prompt
(pass) NewGitHubPromptFormatter > generatePrompt handles timeline comments
(pass) NewGitHubPromptFormatter > generatePrompt handles reviews [1.00ms]
(pass) NewGitHubPromptFormatter > generatePrompt omits empty sections
(pass) NewGitHubPromptFormatter > generatePrompt returns only custom prompt when attachGithubContext is false
(pass) NewGitHubPromptFormatter > generatePrompt includes GitHub context when attachGithubContext is true with custom prompt
(pass) NewGitHubPromptFormatter > generatePrompt includes GitHub context when attachGithubContext is true without custom prompt

::endgroup::

::group::test/jira-json-parser.test.ts:
(pass) Jira JSON Parser > Valid JSON parsing > parses valid comment JSON
(pass) Jira JSON Parser > Valid JSON parsing > parses valid attachments JSON [1.00ms]
(pass) Jira JSON Parser > Valid JSON parsing > parses empty array [1.00ms]
(pass) Jira JSON Parser > Sanitization of unescaped newlines > handles literal \n in comment body
(pass) Jira JSON Parser > Sanitization of unescaped newlines > handles multiple \n in comment body
⚠️  Initial issue_comments parsing failed, attempting sanitization...
✓ Successfully parsed issue_comments after sanitization
(pass) Jira JSON Parser > Sanitization of unescaped newlines > handles actual newline characters
(pass) Jira JSON Parser > Sanitization of unescaped newlines > handles literal \r characters
(pass) Jira JSON Parser > Sanitization of unescaped quotes > handles unescaped quotes in comment body
(pass) Jira JSON Parser > Real-world Jira payloads > handles complex comment from issue #51
(pass) Jira JSON Parser > Real-world Jira payloads > handles long multiline comment from issue #51
(pass) Jira JSON Parser > Real-world Jira payloads > handles multiple comments with newlines
⚠️  Initial issue_comments parsing failed, attempting sanitization...
❌ Failed to parse issue_comments even after sanitization
Original error: 318 |  * @returns Parsed JSON object
319 |  */
320 | export function safeParseJiraJson<T>(rawJson: string, fieldName: string): T {
321 |     // First attempt: try parsing as-is
322 |     try {
323 |         return JSON.parse(rawJson);
                          ^
SyntaxError: JSON Parse error: Unexpected EOF
      at safeParseJiraJson (/home/runner/work/junie-github-action/junie-github-action/src/github/context.ts:323:21)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:115:17)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:116:16)

Sanitization error: 337 |                 .replace(/\\"/g, '"')
338 |                 // Replace actual newlines with spaces
339 |                 .replace(/\n/g, ' ')
340 |                 .replace(/\r/g, ' ');
341 | 
342 |             const result = JSON.parse(sanitized);
                                      ^
SyntaxError: JSON Parse error: Unexpected EOF
      at safeParseJiraJson (/home/runner/work/junie-github-action/junie-github-action/src/github/context.ts:342:33)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:115:17)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:116:16)

Raw data: 
(pass) Jira JSON Parser > Edge cases > handles empty string
⚠️  Initial issue_comments parsing failed, attempting sanitization...
❌ Failed to parse issue_comments even after sanitization
Original error: 318 |  * @returns Parsed JSON object
319 |  */
320 | export function safeParseJiraJson<T>(rawJson: string, fieldName: string): T {
321 |     // First attempt: try parsing as-is
322 |     try {
323 |         return JSON.parse(rawJson);
                          ^
SyntaxError: JSON Parse error: Unexpected identifier "not"
      at safeParseJiraJson (/home/runner/work/junie-github-action/junie-github-action/src/github/context.ts:323:21)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:121:17)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:122:16)

Sanitization error: 337 |                 .replace(/\\"/g, '"')
338 |                 // Replace actual newlines with spaces
339 |                 .replace(/\n/g, ' ')
340 |                 .replace(/\r/g, ' ');
341 | 
342 |             const result = JSON.parse(sanitized);
                                      ^
SyntaxError: JSON Parse error: Unexpected identifier "not"
      at safeParseJiraJson (/home/runner/work/junie-github-action/junie-github-action/src/github/context.ts:342:33)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:121:17)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:122:16)

Raw data: not json at all
(pass) Jira JSON Parser > Edge cases > throws error for completely invalid JSON
⚠️  Initial issue_comments parsing failed, attempting sanitization...
❌ Failed to parse issue_comments even after sanitization
Original error: 318 |  * @returns Parsed JSON object
319 |  */
320 | export function safeParseJiraJson<T>(rawJson: string, fieldName: string): T {
321 |     // First attempt: try parsing as-is
322 |     try {
323 |         return JSON.parse(rawJson);
                          ^
SyntaxError: JSON Parse error: Expected '}'
      at safeParseJiraJson (/home/runner/work/junie-github-action/junie-github-action/src/github/context.ts:323:21)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:127:17)

Sanitization error: 337 |                 .replace(/\\"/g, '"')
338 |                 // Replace actual newlines with spaces
339 |                 .replace(/\n/g, ' ')
340 |                 .replace(/\r/g, ' ');
341 | 
342 |             const result = JSON.parse(sanitized);
                                      ^
SyntaxError: JSON Parse error: Expected '}'
      at safeParseJiraJson (/home/runner/work/junie-github-action/junie-github-action/src/github/context.ts:342:33)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/jira-json-parser.test.ts:127:17)

Raw data: {invalid
(pass) Jira JSON Parser > Edge cases > provides helpful error message on failure
(pass) Jira JSON Parser > Special characters > handles markdown formatting in comments
(pass) Jira JSON Parser > Special characters > handles special characters in author names
(pass) Jira JSON Parser > Special characters > handles URLs in comments

::endgroup::

::group::test/actor.test.ts:
Actor type: User
✓ Verified human actor: contributor-user
(pass) Actor Validation > checkHumanActor > should return true for human actor (type: User)
Actor type: Bot
❌ Workflow initiated by non-human actor: dependabot (type: Bot). Junie can only be triggered by human users to prevent automation loops. If you need automated workflows, use workflow_dispatch or scheduled events.
(pass) Actor Validation > checkHumanActor > should return false for bot actor (type: Bot)
Actor type: Bot
❌ Workflow initiated by non-human actor: github-actions (type: Bot). Junie can only be triggered by human users to prevent automation loops. If you need automated workflows, use workflow_dispatch or scheduled events.
(pass) Actor Validation > checkHumanActor > should return false for github-actions bot
Actor type: User
✓ Verified human actor: alice
(pass) Actor Validation > checkHumanActor > should call GitHub API with correct username
❌ Failed to verify actor information for "contributor-user". This could be due to: 
• GitHub API rate limits
• Insufficient token permissions
• Network connectivity issues
Original error: API rate limit exceeded
(pass) Actor Validation > checkHumanActor > should return false on API errors
❌ Failed to verify actor information for "contributor-user". This could be due to: 
• GitHub API rate limits
• Insufficient token permissions
• Network connectivity issues
Original error: [object Object]
(pass) Actor Validation > checkHumanActor > should return false on 404 user not found [1.00ms]
Actor type: User
✓ Verified human actor: john-doe
Actor type: User
✓ Verified human actor: jane_smith
Actor type: User
✓ Verified human actor: user123
Actor type: User
✓ Verified human actor: test-user-42
(pass) Actor Validation > checkHumanActor > should work with different actor names

::endgroup::

::group::test/format-summary.test.ts:
(pass) Format Junie Summary > should format basic summary
(pass) Format Junie Summary > should include action details
(pass) Format Junie Summary > should format error messages
(pass) Format Junie Summary > should include duration if available
(pass) Format Junie Summary > should handle minimal output
(pass) Format Junie Summary > should use correct emoji for action types
(pass) Format Junie Summary > should format complete execution report

::endgroup::

::group::test/comment-feedback.test.ts:
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:69:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:68:44)

Created initial comment with ID: 12345
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should create comment on issue [1.00ms]
Issue comment detected - adding thumbs (comment ID: 888)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:85:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:84:41)

Created initial comment with ID: 12345
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should create comment on PR [1.00ms]
Pull Request review comment detected - adding thumbs (review comment ID: 666)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForPullRequestReviewComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:82:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:100:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:99:52)

Created initial comment with ID: 67890
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should create reply for review comment
Skip creating initial comment for workflow_dispatch event - no entity number
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should skip creating comment for events without entity number
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:129:13)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:128:57)

Created initial comment with ID: 12345
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should include job run link in comment body
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:144:13)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:140:38)

❌ Failed to create/update initial feedback comment for issue #55: 136 |         })
137 |       );
138 |     });
139 | 
140 |     test("should handle API errors", async () => {
141 |       createCommentSpy.mockRejectedValue(new Error("API Error"));
                                                   ^
error: API Error
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:141:46)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:140:38)

(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should handle API errors
Silent mode enabled - skipping initial feedback comment
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should skip comment creation in silent mode
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:165:13)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:164:57)

Created initial comment with ID: 12345
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should include Junie marker in comment body
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:187:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:175:102)

Single comment mode enabled - searching for existing Junie comment
No existing Junie comment found
No existing Junie comment found - creating new comment
Created initial comment with ID: 12345
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should create new comment when useSingleComment is enabled but no existing comment found [1.00ms]
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:212:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:195:95)

Single comment mode enabled - searching for existing Junie comment
Found existing Junie comment with ID: 99999
Updating existing comment 99999 with new content
Updated comment with ID: 99999
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should update existing comment when useSingleComment is enabled and comment found
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:242:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:224:71)

Single comment mode enabled - searching for existing Junie comment
Found existing Junie comment with ID: 33333
Updating existing comment 33333 with new content
Updated comment with ID: 33333
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should find most recent Junie comment when multiple exist
Pull Request review comment detected - adding thumbs (review comment ID: 666)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForPullRequestReviewComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:82:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:272:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:254:95)

Single comment mode enabled - searching for existing Junie comment
Searching for Junie comment in review thread 666
Found 1 comments in the review thread
Found existing Junie comment with ID: 88888
Updating existing comment 88888 with new content
Updated comment with ID: 88888
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should update review comment when useSingleComment is enabled for review comments [1.00ms]
Pull Request review comment detected - adding thumbs (review comment ID: 666)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForPullRequestReviewComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:82:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:303:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:280:70)

Single comment mode enabled - searching for existing Junie comment
Searching for Junie comment in review thread 666
Found 1 comments in the review thread
Found existing Junie comment with ID: 22222
Updating existing comment 22222 with new content
Updated comment with ID: 22222
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should search only within specific review comment thread
Pull Request review comment detected - adding thumbs (review comment ID: 666)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForPullRequestReviewComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:82:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:336:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:315:63)

Single comment mode enabled - searching for existing Junie comment
Searching for Junie comment in review thread 666
Found 1 comments in the review thread
Found existing Junie comment with ID: 666
Updating existing comment 666 with new content
Updated comment with ID: 666
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should find parent comment if it has Junie marker
Issue comment detected - adding thumbs (comment ID: 999)
Failed to add thumbs up reaction to trigger comment: TypeError: undefined is not an object (evaluating 'octokit.rest.reactions.createForIssueComment')
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:72:32)
      at addThumbsUpToTriggerComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:34:5)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:256:11)
      at postJunieWorkingStatusComment (/home/runner/work/junie-github-action/junie-github-action/src/github/operations/comments/feedback.ts:234:5)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:355:31)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:342:82)

Single comment mode enabled - searching for existing Junie comment
Error searching for existing Junie comment: 347 |           useSingleComment: true,
348 |         },
349 |       } as JunieExecutionContext;
350 | 
351 |       // Mock listComments to throw an error
352 |       listCommentsSpy.mockRejectedValue(new Error("API Error"));
                                                  ^
error: API Error
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:352:45)
      at <anonymous> (/home/runner/work/junie-github-action/junie-github-action/test/comment-feedback.test.ts:342:82)

No existing Junie comment found - creating new comment
Created initial comment with ID: 12345
(pass) Comment Feedback Operations > postJunieWorkingStatusComment > should gracefully handle errors when searching for existing comments
Commit pushed to current branch: abc123def456
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update comment with success for COMMIT_CHANGES [1.00ms]
PR was created: https://github.com/test-owner/test-repo/pull/300
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update comment with success for CREATE_PR
Create PR manually
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update comment with manual PR creation link when no PR link
Unpushed commits were pushed to remote
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update comment with success for PUSH
No PR or commit - using Junie result
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update comment with success for WRITE_COMMENT
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update comment with failure message
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should include job link in failure message [1.00ms]
No PR or commit - using Junie result
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should update review comment for review comment context
Updating feedback comment 12345
Updating existing comment 12345 with new content
Updated comment with ID: 12345
✓ Feedback comment updated successfully
(pass) Comment Feedback Operations > postJunieCompletionComment > should handle failure without error message

::endgroup::

::group::test/trigger-validation.case-insensitive.test.ts:
Issue body contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation - case insensitive > should match trigger phrase in issue body regardless of case
Issue title contains exact trigger phrase '@junie-agent'
(pass) Trigger Validation - case insensitive > should match trigger phrase in issue title regardless of case
Comment contains exact trigger phrase '/(^|\s)@junie-agent([\s.,!?;:]|$)/i'
(pass) Trigger Validation - case insensitive > should match trigger phrase in comments regardless of case

::endgroup::

::group::test/junie-tasks.test.ts:
(pass) prepareJunieTask > with user prompt > should set task from inputs.prompt with GitHub context by default [1.00ms]
(pass) prepareJunieTask > with user prompt > should set task from inputs.prompt without GitHub context when disabled
(pass) prepareJunieTask > issue comment event (not on PR) > should format issue comment prompt
(pass) prepareJunieTask > issues event > should format issue prompt
(pass) prepareJunieTask > PR comment event > should format PR comment prompt with all details [1.00ms]
(pass) prepareJunieTask > PR review event > should format PR review prompt
(pass) prepareJunieTask > PR review event > should replace CODE_REVIEW_ACTION phrase with default code review prompt
Comment contains exact trigger phrase '/code-review/i'
(pass) prepareJunieTask > PR review event > should use default code review prompt when code-review is in comment [1.00ms]
(pass) prepareJunieTask > PR review event > should replace FIX_CI_ACTION phrase with default fix CI prompt
(pass) prepareJunieTask > PR review event > should automatically trigger fix CI prompt when workflow_run event has failure conclusion
(pass) prepareJunieTask > PR review event > should not trigger fix CI prompt when workflow_run event has success conclusion
Comment contains exact trigger phrase '/fix-ci/i'
(pass) prepareJunieTask > PR review event > should use default fix CI prompt when fix-ci is in comment [1.00ms]
(pass) prepareJunieTask > PR review comment event > should format PR review comment prompt
(pass) prepareJunieTask > PR event > should format PR prompt for opened/edited PR
(pass) prepareJunieTask > merge task > should set merge task when resolveConflicts input is true
Comment contains exact trigger phrase '/resolve conflicts/i'
(pass) prepareJunieTask > merge task > should set merge task when comment has resolve trigger phrase
(pass) prepareJunieTask > output > should call core.setOutput with JSON stringified task [1.00ms]
(pass) prepareJunieTask > integration > should handle multiple event types in sequence

::endgroup::

::group::test/sanitizer.test.ts:
(pass) Sanitizer > HTML comments removal > removes simple HTML comments
(pass) Sanitizer > HTML comments removal > removes multi-line HTML comments
(pass) Sanitizer > Invisible characters removal > removes zero-width spaces
(pass) Sanitizer > Invisible characters removal > removes zero-width non-joiner
(pass) Sanitizer > Invisible characters removal > removes unicode direction marks
(pass) Sanitizer > Invisible characters removal > preserves normal whitespace
(pass) Sanitizer > Markdown sanitization > removes image alt text
(pass) Sanitizer > Markdown sanitization > removes link titles
(pass) Sanitizer > HTML attributes removal > removes alt attributes
(pass) Sanitizer > HTML attributes removal > removes title attributes
(pass) Sanitizer > HTML attributes removal > removes data-* attributes
(pass) Sanitizer > HTML attributes removal > removes aria-label attributes
(pass) Sanitizer > HTML entity decoding > decodes decimal entities
(pass) Sanitizer > HTML entity decoding > decodes hex entities
(pass) Sanitizer > HTML entity decoding > removes non-printable entities
(pass) Sanitizer > GitHub token redaction > redacts classic PAT tokens (ghp_)
(pass) Sanitizer > GitHub token redaction > redacts OAuth tokens (gho_)
(pass) Sanitizer > GitHub token redaction > redacts installation tokens (ghs_)
(pass) Sanitizer > GitHub token redaction > redacts fine-grained PAT tokens
(pass) Sanitizer > GitHub token redaction > redacts multiple tokens
(pass) Sanitizer > Combined attacks > handles multiple attack vectors at once
(pass) Sanitizer > Edge cases > handles null input
(pass) Sanitizer > Edge cases > handles undefined input
(pass) Sanitizer > Edge cases > handles empty string
(pass) Sanitizer > Edge cases > preserves legitimate content
(pass) Sanitizer > Real-world scenarios > sanitizes malicious PR description
(pass) Sanitizer > Real-world scenarios > sanitizes issue with encoded injection
(pass) Sanitizer > Junie Output Sanitization > Token redaction in output > redacts tokens from Junie's response
(pass) Sanitizer > Junie Output Sanitization > Token redaction in output > redacts multiple token types
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > replaces default trigger phrase with neutral term
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > replaces custom trigger phrase [1.00ms]
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > replaces trigger phrase case-insensitively
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > handles trigger phrase with special regex characters
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > replaces trigger phrase at start of string
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > replaces trigger phrase followed by punctuation
(pass) Sanitizer > Junie Output Sanitization > Trigger phrase replacement > does not replace trigger phrase inside words
(pass) Sanitizer > Junie Output Sanitization > Combined sanitization > handles both tokens and trigger phrases
(pass) Sanitizer > Junie Output Sanitization > Edge cases > handles undefined input
(pass) Sanitizer > Junie Output Sanitization > Edge cases > handles empty string
(pass) Sanitizer > Junie Output Sanitization > Edge cases > preserves normal content

::endgroup::

::group::test/integration/issue_trigger.test.ts:
Skipping E2E tests: GITHUB_TOKEN is not set
(pass) Trigger Junie in Issue > create PR on issue based on the description

::endgroup::

::group::src/github/jira/markdown-to-jira.test.ts:
(pass) convertMarkdownToADF > returns valid ADF document structure [3.00ms]
(pass) convertMarkdownToADF > converts simple text to paragraph [1.00ms]
(pass) convertMarkdownToADF > converts headers
(pass) convertMarkdownToADF > converts bold text [1.00ms]
(pass) convertMarkdownToADF > converts inline code
(pass) convertMarkdownToADF > converts links
(pass) convertMarkdownToADF > converts complex example [1.00ms]

::endgroup::

 183 pass
 0 fail
 469 expect() calls
Ran 183 tests across 13 files. [4.27s]
